# 在线智能盖章工具

## 简介 (Introduction)

在线智能盖章工具是一款便捷的网页应用，允许用户轻松地为其图片和PDF文档添加电子印章。用户可以上传本地文档和印章图片，通过直观的界面调整印章的位置、大小、旋转角度和透明度，最后将盖好章的文档下载保存。

本工具旨在简化在数字文档上加盖印章的流程，特别适用于需要快速处理少量文档盖章的场景。

## 功能特点 (Features)

- **支持多种文档格式**：可以上传常见的图片格式（PNG, JPG, GIF等）和PDF文件作为待盖章的文档。
- **自定义印章上传**：支持上传PNG、JPG、GIF等格式的图片作为电子印章，推荐使用背景透明的PNG印章以获得最佳效果。
- **印章交互式调整**：
    - **拖拽移动**：鼠标悬停在印章上时，光标变为可拖动状态，直接拖动印章以调整位置。
    - **缩放**：拖动印章边框上的控制点（四角）可以按比例缩放印章。
    - **旋转**：拖动印章顶部的旋转控制点可以旋转印章。
    - **透明度调节**：通过滑块实时调整当前选中印章的透明度。
- **多印章支持**：可以在同一文档上添加并管理多个印章。
- **印章操作控件**：
    - **删除印章**：选中印章后，点击其左上角的红色删除图标（诊断模式下为红色方块，若SVG加载失败则为占位符）可移除该印章。
    - **复制印章**：选中印章后，点击其右上角的绿色复制图标（诊断模式下为绿色方块，若SVG加载失败则为占位符）可快速复制一个相同的印章。
- **视图控制**：
    - **缩放**：提供放大、缩小、重置视图大小的按钮，也支持使用鼠标滚轮进行缩放。
    - **平移**：按住 `Alt` 键并用鼠标拖动可以平移文档视图。
- **结果下载**：完成印章调整后，可以点击“确认并下载”按钮，将盖章后的文档（目前统一输出为PNG格式）下载到本地。
- **响应式设计**：界面适配不同屏幕尺寸，方便在桌面和移动设备上使用（主要针对桌面优化）。

## 如何使用 (How to Use)

1.  **上传文档**：点击“上传盖章文件”按钮，选择您电脑中的图片或PDF文件。上传成功后，文件内容将显示在主预览区域。
2.  **调整视图（可选）**：
    *   使用预览区下方的“放大视图”、“缩小视图”、“重置视图”按钮调整文档的可视大小。
    *   使用鼠标滚轮在预览区内滚动，同样可以缩放视图。
    *   按住 `Alt` 键并用鼠标在预览区拖动，可以平移文档视图。
3.  **上传印章**：文档上传完毕后，“上传印章图片”按钮将变为可用。点击该按钮，选择您的电子印章图片（推荐使用背景透明的PNG格式）。印章添加后将默认被选中，并显示操作控件。
4.  **调整印章**：
    *   **移动**：将鼠标悬停在印章上，当光标变为“move”（四向箭头）时，点按并拖动印章到目标位置。
    *   **缩放**：点按并拖动选中印章四角的圆形控制点，可以放大或缩小印章。
    *   **旋转**：点按并拖动选中印章顶部的圆形旋转控制点，可以旋转印章。
    *   **透明度**：当印章被选中时，“调整印章透明度”滑块变为可用。拖动滑块可以实时改变印章的透明度。
    *   **删除**：选中印章后，点击其左上角的红色删除图标（或红色方块/占位符）即可删除该印章。
    *   **复制**：选中印章后，点击其右上角的绿色复制图标（或红色方块/占位符）即可在旁边创建一个该印章的副本。新复制的印章将自动被选中。
5.  **重复步骤3和4**：如果需要，可以上传并调整多个印章。
6.  **下载文件**：所有印章调整满意后，点击“确认并下载”按钮。浏览器将开始下载一个名为 `盖章文档-时间戳.png` 的图片文件。

## 技术栈 (Tech Stack)

- **HTML5**: 网页结构。
- **Tailwind CSS**: UI样式和布局。
- **JavaScript**: 核心交互逻辑。
- **Fabric.js (v5.3.0)**: 强大的HTML5 Canvas库，用于实现画布操作、对象（文档背景、印章）的添加、选择、拖拽、缩放、旋转、删除、复制以及最终的图像合成与导出。
- **PDF.js (v3.11.174)**: 用于解析和在Canvas上渲染PDF文件（目前仅渲染第一页）。

## 注意事项 (Important Notes)

- **浏览器兼容性**：建议使用最新版本的现代桌面浏览器（如Chrome, Firefox, Edge, Safari）以获得最佳体验。
- **PDF渲染**：复杂的PDF或包含特殊字体的PDF可能存在渲染不完美的情况。目前仅渲染PDF的第一页。
- **印章图片**：为了获得最佳效果，推荐使用背景透明的PNG图片作为印章。
- **输出格式**：目前，无论输入文档是图片还是PDF，最终盖章完成下载的文件均为PNG格式。
- **诊断与调试功能（开发阶段保留）**：
    - **"Add Test Rect (Debug)"按钮**：此黄色按钮用于在画布上添加一个紫色的测试矩形。该矩形使用Fabric.js的默认交互控件。此功能用于快速验证Fabric.js核心交互（选择、拖拽、缩放、旋转）是否在当前环境中正常工作，以区分是应用逻辑问题还是库或环境问题。点击后会有`alert`提示，并在控制台输出相关信息。
    - **"Log Active Seal State"按钮**：此橙色按钮用于将被选中的印章（如果当前有印章被选中）的详细状态信息输出到浏览器的开发者控制台。这些信息包括其位置、大小、角度、透明度、是否可选、是否有控件、控件对象等，用于深入调试印章对象的具体状态。点击后会有`alert`提示。
    - **自定义控件的简化渲染与警报**：为了诊断自定义控件（删除/复制）的问题，其渲染逻辑被临时修改为显示简单的红色/绿色方块，并且其事件处理器 (`actionHandler`) 会首先触发一个 `alert` 提示框。这有助于确认控件是否被正确渲染以及其事件处理器是否被调用。
    - **开发者控制台日志**：应用中包含了大量的 `console.log` 语句，用于在浏览器开发者控制台中输出程序运行状态、事件触发情况、对象属性、Fabric.js版本等，帮助开发者追踪问题。这些日志对于普通用户是不可见的，但对于调试至关重要。
    - **控件隔离测试**：代码中包含用于临时移除自定义控件、仅保留标准缩放/旋转控件的注释掉的测试代码段 (`tempStandardControlsOnly` in `overrideFabricControls`)。开发者可以取消注释此部分以单独测试标准控件的功能。
    - **`perPixelTargetFind` 测试**：代码中包含用于临时禁用 `perPixelTargetFind` 属性的注释掉的测试代码段 (`handleStampSelection`内)。开发者可以取消注释以测试该属性对交互的影响。

---

这个README旨在为用户和潜在的开发者提供关于此“在线智能盖章工具”的清晰概述及其当前的诊断功能。
