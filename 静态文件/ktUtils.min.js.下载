const ktUtils={msg:function(msg,time){this.showMsg("msg",msg,time||3500,!1)},snakeMsg:function(msg,time){this.showMsg("snakeMsg",msg,time||3500,!0)},showMsg:function(type,msg,time,snake){let title,cl;msg||(msg=".........."),"snakeMsg"===type?(title="",cl="kt-alert-msg-snake"):(title="",cl="kt-alert-msg");let alertEle=$(".alert"),bodyEle=$("body");alertEle.length>0&&alertEle.remove(),bodyEle.append('<div data-tag="kt-alert" class="alert '+cl+' fade show kt-alert-box" style=""><a href="#" class="kt-alert-close" data-bs-dismiss="alert" aria-label="Close" style="line-height: 0.9;">&times;</a><strong>'+title+"</strong>"+msg+"</div>");let alertElm=bodyEle.find(".alert");if(-1===time)return;let timeoutId=setTimeout((function(){0!==alertElm.length&&alertElm.remove()}),time);alertElm.on("mouseover",(function(event){timeoutId&&clearTimeout(timeoutId)})),alertElm.on("mouseout",(function(event){timeoutId=setTimeout((function(){0!==alertElm.length&&alertElm.remove()}),time)}))},modalMsg:function(message){var modalEle=$("#myModal");modalEle.find(".modal-body").text(message),modalEle.modal("show")},initFileUploadControl:function(id,uploadUrl,allowFile,params,customParams){const control=$("#"+id);allowFile||(allowFile=["jpg","png","jpeg","bmp"]),params||(params={});var allParams={language:"zh",uploadUrl:uploadUrl,enctype:"multipart/form-data",allowedFileExtensions:allowFile,showPreview:!0,showUpload:!1,showCaption:!0,showRemove:!0,showRotate:!1,autoReplace:!0,overwriteInitial:!0,uploadAsync:!0,maxFileSize:10240,minFileCount:1,maxFileCount:1,validateInitialCount:!0,uploadExtraData:function(){return params},layoutTemplates:{actionUpload:"",actionZoom:""}};customParams&&Object.keys(customParams).forEach((function(key){allParams[key]=customParams[key]}));return control.fileinput(allParams),control},initDzUpload:function(id,options,fileType){let initOptions={url:ktConfig.api.fileUpload+(fileType||""),paramName:"file",maxFilesize:10,chunking:!1,chunkSize:1048576,parallelChunkUploads:!0,uploadMultiple:!1,addRemoveLinks:!0,thumbnailMethod:"crop",dictRemoveFile:"移除文件",dictMaxFilesExceeded:"超出最大文件数（{{maxFiles}}）个限制",dictFileTooBig:"文件超出最大限制大小：{{maxFilesize}} MiB",dictInvalidFileType:"你不能上传这种类型的文件",dictResponseError:"服务器用{{statusCode}}代码响应",init:function(){this.on("reset",(function(){if(0!==this.files.length){for(let i=0;i<this.files.length;i++)this.files[i].previewElement.remove();this.files.length=0}})),this.on("maxfilesexceeded",(function(file){this.removeFile(file)})),this.on("error",(function(file,errorMessage){ktUtils.snakeMsg(errorMessage)}))},sending:function(file,xhr,formData){},maxfilesexceeded:function(file){}};return $.extend(initOptions,options),new Dropzone("#"+id,initOptions)},renderNavTab:function(navTabType){var tabArr=[],toolName=$(".breadcrumb").find(".active").text();this.getAllMenus().forEach((function(item){item.moduleType===navTabType&&item.menu.forEach((function(itm){tabArr.push(itm)}))})),tabArr&&toolName?tabArr.forEach((function(obj){obj.name===toolName?$("#ktTab").append('<li class="nav-item">\n            <a class="nav-link kt-fs13 active" data-tId="'+obj.id+'" href="'+kfc+obj.url+'">'+obj.name+"</a>\n        </li>"):$("#ktTab").append('<li class="nav-item">\n            <a class="nav-link kt-fs13" href="'+kfc+obj.url+'">'+obj.name+"</a>\n        </li>")})):error("renderNavTab error: tabArr or key must be not null")},fixedImg:function(src){var fkiEle=$(".fakeimg");if(src){var img=new Image;img.src=src;var imgW=img.width,imgH=img.height,divH=fkiEle.parent().parent().height(),divW=fkiEle.parent().parent().width(),scaleDivHw=divH/divW;img.onload=function(){imgW=img.width;var scaleImgHw=(imgH=img.height)/imgW;divH-imgH>=0&&divW-imgW>=0?fkiEle.attr("style","width:auto;height:auto;"):divH-imgH>=0&&divW-imgW<0?fkiEle.attr("style","height:auto;width:"+divW+"px;"):divH-imgH<0&&divW-imgW>=0?fkiEle.attr("style","width:auto;height:"+(divH-8)+"px;"):scaleImgHw>scaleDivHw?fkiEle.attr("style","height:"+(divH-8)+"px;width:auto"):fkiEle.attr("style","height:"+(divH-8)+"px;width:"+divW+"px;")}}},handleUrl:function(url){return url?kfc+url:"#"},aGet:function(url,params,callback){$.ajax({type:"GET",url:kfc+url,data:params,success:callback})},aPost:function(url,params,callback){$.ajax({type:"POST",url:kfc+url,data:params,success:callback})},get:function(url,params){return this.ajx(url,params,"GET")},post:function(url,params){return this.ajx(url,params,"POST")},ajx:function(url,params,method){var result="";return url?(params||(params={}),method||(method="GET"),$.ajax({type:method,url:kfc+url,data:params,async:!1,success:function(r){result=r}}),result):result},postJson:function(url,data,fun){$.ajax({type:"POST",url:url,dataType:"JSON",contentType:"application/json;charset=utf-8",data:JSON.stringify(data),success:fun})},setCookie:function(key,val){$.cookie(key,JSON.stringify(val),{path:"/"})},getCookie:function(key){var val=$.cookie(key);return val?$.parseJSON(val):val},delCookie:function(key){$.cookie(key,"",{expires:-1,path:"/"})},getAllMenus:function(){var allMenus=ktUtils.getCookie("allMenus");return allMenus||(200===(allMenus=ktUtils.get(ktConfig.api.allMenus)).errorCode?allMenus.data:"")},getFormJsonData:function(formId){let json={};return $("#"+formId).serializeArray().forEach((function(item){if(item.value&&(json.hasOwnProperty(item.name)?json[item.name]+=","+item.value:json[item.name]=item.value),item.name.endWith("]")){let tempName=item.name.substring(item.name.indexOf("["),item.name.length),arrayKeyName=tempName.substring(1,tempName.length-1),objKeyName=item.name.substring(0,item.name.indexOf(tempName));if(json.hasOwnProperty(arrayKeyName)){let temArr=json[arrayKeyName],done=!1;for(let idx in temArr){let obj=temArr[idx];if(!obj.hasOwnProperty(objKeyName)){obj[objKeyName]=item.value,done=!0;break}}if(!done){let tmpObj={};tmpObj[objKeyName]=item.value,json[arrayKeyName].push(tmpObj)}}else{let tmpObj={};tmpObj[objKeyName]=item.value,json[arrayKeyName]=[tmpObj]}}})),json},parseJson:function(str){if(!str)return"";var json;try{if(!isNaN(str))return"";json=eval("("+str+")")}catch(e){json={},str=str.replace(/[ ]/g,""),str=str.replace(/[\r\n]/g,"");var sArr=str.split("&");sArr.forEach((function(value){var fArr=value.split("=");if(fArr.length<2)return!0;json[fArr[0]]=fArr[1]}))}return 0===Object.keys(json).length?"":json},formatJson:function(json,options){var reg=null,formatted="",pad=0;return(options=options||{}).newlineAfterColonIfBeforeBraceOrBracket=!0===options.newlineAfterColonIfBeforeBraceOrBracket,options.spaceAfterColon=!1!==options.spaceAfterColon,"string"!=typeof json&&(json=JSON.stringify(json)),json=JSON.parse(json),reg=/([\{\}])/g,json=(json=JSON.stringify(json)).replace(reg,"\r\n$1\r\n"),reg=/([\[\]])/g,json=json.replace(reg,"\r\n$1\r\n"),reg=/(\,)/g,json=json.replace(reg,"$1\r\n"),reg=/(\r\n\r\n)/g,json=json.replace(reg,"\r\n"),reg=/\r\n\,/g,json=json.replace(reg,","),options.newlineAfterColonIfBeforeBraceOrBracket||(reg=/\:\r\n\{/g,json=json.replace(reg,":{"),reg=/\:\r\n\[/g,json=json.replace(reg,":[")),options.spaceAfterColon&&(reg=/\:/g,json=json.replace(reg,": ")),$.each(json.split("\r\n"),(function(index,node){var i=0,indent=0,padding="";for(node.match(/\{$/)||node.match(/\[$/)?indent=1:node.match(/\}/)||node.match(/\]/)?0!==pad&&(pad-=1):indent=0,i=0;i<pad;i++)padding+="    ";formatted+=padding+node+"\r\n",pad+=indent})),formatted},formatJSON:function(txt,compress){if(!/^\s*$/.test(txt)){var draw=[],line=compress?"":"\n",notify=function(name,value,isLast,indent,formObj){0;for(var i=0,tab="";i<indent;i++)tab+="    ";if(tab=compress?"":tab,++indent,value&&value.constructor==Array){draw.push(tab+(formObj?'"'+name+'":':"")+"["+line);for(i=0;i<value.length;i++)notify(i,value[i],i==value.length-1,indent,!1);draw.push(tab+"]"+(isLast?line:","+line))}else if(value&&"object"==typeof value){draw.push(tab+(formObj?'"'+name+'":':"")+"{"+line);var len=0;i=0;for(var key in value)len++;for(var key in value)notify(key,value[key],++i==len,indent,!0);draw.push(tab+"}"+(isLast?line:","+line))}else draw.push(tab+(formObj?'"'+name+'":':"")+value+(isLast?"":",")+line)};return notify("",txt,!0,0,!1),draw.join("")}ktUtils.snakeMsg("数据为空,无法格式化! ")},checkBrowser:function(){var userAgent=window.navigator.userAgent.toLowerCase();return/chrome/.test(userAgent)&&!/edge/.test(userAgent)?ktConfig.browserType.chrome:/edge/.test(userAgent)?ktConfig.browserType.edg:/trident/.test(userAgent)?ktConfig.browserType.ie:/firefox/.test(userAgent)?ktConfig.browserType.firefox:void 0},isMobile:function(){return/(iPhone|iPad|iPod|iOS|Android|Linux armv8l|Linux armv7l|Linux aarch64)/i.test(navigator.platform)},hexToRgb:function(hex){var sColor=hex.toLowerCase();if(sColor&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(sColor)){if(4===sColor.length){for(var sColorNew="#",i=1;i<4;i+=1)sColorNew+=sColor.slice(i,i+1).concat(sColor.slice(i,i+1));sColor=sColorNew}var sColorChange=[];for(i=1;i<7;i+=2)sColorChange.push(parseInt("0x"+sColor.slice(i,i+2)));return sColorChange.join(",")}return sColor},rgbToHex:function(rgb){var hex="#";for(k in rgb){var h=Number(rgb[k]).toString(16).toUpperCase();1===h.length?hex+="0"+h:hex+=h}return hex},initComments:function(current,size,isMsg){current||(current=1);let toolId=ktcfg.toolId,toolLevel=ktcfg.toolLevel;if(!isMsg&&(1688===toolId||1!==toolLevel))return;let params={menuId:toolId,userId:ktUtils.getUserId()||ktConfig.userId,current:current,size:5|size};this.aGet(ktConfig.api.userComments,params,(function(r){if(r.errorCode===ktConfig.request.okCode){let data=r.data;if(!data)return;ktConfig.userId=data.userId,ktConfig.nickname=data.nickname,ktConfig.isVip=ktUtils.checkVipEndDate(data.vip1EndDate),ktConfig.isSealVip=ktUtils.checkVipEndDate(data.vip2EndDate),ktConfig.isVip&&ktUtils.setVipBtn(),ktConfig.isSealVip&&ktUtils.setVip2Btn();const baseHeadUrl=kfc+"/comm/static/head?url=";let $lnEl=$("#likeNum");$lnEl.text(data.likeNum),$lnEl.parent().attr("data-likeIt",data.likeIt),1===data.likeIt&&$lnEl.prev().addClass("kt-comment-liked"),$("#isLike").text(data.likeIt);let $geaEl=$(".gitment-editor-avatar");$geaEl.attr("title",data.nickname),$geaEl.attr("href",data.avatar),$geaEl.find("img").attr("src",baseHeadUrl+encodeURIComponent(data.avatar));let comments=data.comments,total=comments.total,records=comments.records,pages=comments.pages;const masterUserId=49532;ktConfig.userId;let shareNumStr=total;if(total>=100&&(shareNumStr="100+"),$("#share-comments-num").text(shareNumStr),$("#comments-num").text(total),total>0){let commentsHtml=new StringBuilder;records.forEach((function(item){let heartClass="";heartClass=1===item.likeIt?"fa fa-heart kt-heart15-red":"fa fa-heart kt-heart15-empty",commentsHtml.append('<li class="gitment-comment" id="'+item.id+'">\n                                    \x3c!--头像--\x3e\n                                    <a class="gitment-comment-avatar" href="'+item.avatar+'" target="_blank">\n                                        <img class="gitment-comment-avatar-img" src="'+baseHeadUrl+encodeURIComponent(item.avatar)+'" alt="头像">\n                                    </a>\n                                    \x3c!-- 主要内容 --\x3e\n                                    <div class="gitment-comment-main">\n                                        <div class="gitment-comment-header">\n                                            <a class="gitment-comment-name" href="javascript:void(0);" target="_blank" id="'+item.userId+'">'+item.nickname+"</a>"),item.userId===masterUserId&&commentsHtml.append(' <span class="master-tag">站长</span>'),1===item.isVip&&commentsHtml.append(' <img class="kt-vip-logo-o" title="网站会员VIP" src="/static/image/icon/KT-VIP1-Z.png">'),1===item.isSealVip&&commentsHtml.append(' <img class="kt-vip-logo-o" title="印章专属会员VIP" src="/static/image/icon/章-VIP2-Z.png">'),commentsHtml.append("\n"),commentsHtml.append('                                            发表于\n                                            <span title="">'+item.createTime+'</span>\n                                            <div data-likeIt="'+item.likeIt+'" onclick="likeComment(this)" class="gitment-comment-like-btn" title="'+(0===item.likeIt?"点赞":"取消点赞")+'"><span class="'+heartClass+'"></span><span class="commentLikeNum">'+item.commentLikeNum+"</span></div>\n"),ktUtils.getUserId()===masterUserId&&commentsHtml.append('                                            <div data-user-id="'+item.userId+'" onclick="deleteComment(this)" class="gitment-comment-like-btn" title="删除评论"><i class="fa fa-trash" style="padding-right: 3px;color: #b0b0b0"></i></div>\n                                            <div data-user-id="'+item.userId+'" onclick="deleteAndBanComment(this)" class="gitment-comment-like-btn" title="删除并拉黑"><i class="fa fa-ban" style="padding-right: 3px;color: #b0b0b0"></i></div>\n'),commentsHtml.append('                                        </div>\n                                        <div class="gitment-comment-body gitment-markdown">                                            <div class="comment-content-text">'+ktUtils.makeHtml(item.comment)+'</div>\n                                            <div class="reply-button-panel">\n                                                <span title="回复" onclick="replyCommentFocus(this)">回复</span>&nbsp;&nbsp;\n\x3c!--                                            <span title="删除">删除</span>--\x3e\n                                            </div>\n'),commentsHtml.append("                                            \x3c!-- children comment start --\x3e\n");let replyRecords=item.commentReplyList;replyRecords.length>0?(commentsHtml.append('                                            <div class="reply-content-box reply-content-box-margin">\n'),replyRecords.forEach((function(replyItem){var heartClass="";heartClass=1===replyItem.likeIt?"fa fa-heart kt-heart15-red":"fa fa-heart kt-heart15-empty",commentsHtml.append('<div class="reply-item" id="'+replyItem.id+'">\n                                                <div class="reply-user-avatar">\n                                                    <a href="'+replyItem.avatar+'" target="_blank">\n                                                        <img class="gitment-comment-avatar-img" src="'+baseHeadUrl+encodeURIComponent(replyItem.avatar)+'" alt="头像">\n                                                    </a>\n                                                </div>\n                                                <div class="reply-content">\n                                                    <a style="color: #555666; font-weight: 600" href="javascript:void();" target="_blank" data-reply-comment-id="'+replyItem.id+'" id="'+replyItem.userId+'">'+replyItem.nickname+"</a>"),replyItem.userId===masterUserId&&commentsHtml.append(' <span class="master-tag">站长</span>'),1===replyItem.isVip&&commentsHtml.append(' <img class="kt-vip-logo-o" title="网站会员VIP" src="/static/image/icon/KT-VIP1-Z.png">'),1===replyItem.isSealVip&&commentsHtml.append(' <img class="kt-vip-logo-o" title="印章专属会员VIP" src="/static/image/icon/章-VIP2-Z.png">'),commentsHtml.append("\n"),commentsHtml.append('                                                    <span style="color: #999"> 回复 </span>\n'),commentsHtml.append('                                                    <span style="color: #555666; font-weight: 600">'),replyItem.replyNickname&&commentsHtml.append(replyItem.replyNickname),commentsHtml.append("</span>：\n"),commentsHtml.append("                                                    <span>"+ktUtils.makeHtml(replyItem.content)+'</span>\n                                                </div>\n                                                <div class="reply-button-panel">\n                                                    <span class="reply-button" title="回复" onclick="replyChildrenCommentFocus(this)">回复</span>&nbsp;&nbsp;\n\x3c!--                                                    <span class="reply-button" title="删除">删除</span>&nbsp;&nbsp;--\x3e\n                                                    <div data-likeit="'+replyItem.likeIt+'" onclick="likeReply(this)" class="gitment-comment-like-btn" style="float: left;"><span class="'+heartClass+'"></span><span class="commentLikeNum">'+replyItem.likeNum+"</span></div>\n"),ktUtils.getUserId()===masterUserId&&commentsHtml.append('                                            <div data-user-id="'+replyItem.userId+'" onclick="deleteReplyComment(this)" class="gitment-comment-like-btn" title="删除评论"><i class="fa fa-trash" style="padding-right: 3px;"></i></div>\n                                            <div data-user-id="'+replyItem.userId+'" onclick="deleteAndBanReplyComment(this)" class="gitment-comment-like-btn" title="删除并拉黑"><i class="fa fa-ban" style="padding-right: 3px;"></i></div>\n'),commentsHtml.append('                                                    <span style="color: #999; float: left;">&nbsp;&nbsp;'+ktUtils.diffNowDateFormat(replyItem.createTime)+"</span>                                                </div>\n                                            </div>")})),commentsHtml.append("                                            <div>\n")):(commentsHtml.append('                                            <div class="reply-content-box">\n'),commentsHtml.append("                                            <div>\n")),commentsHtml.append("                                        <div>\n"),commentsHtml.append("                                    </div>\n"),commentsHtml.append("                                </li>")})),$("#commentList").html(commentsHtml.toString());for(var $cpEl=$("#commentPage"),pageHtml=new StringBuilder,i=1;i<=pages;i++){if(i===current)pageHtml.append('<li class="gitment-comments-page-item gitment-selected">'+i+"</li>");else if(pageHtml.append('<li class="gitment-comments-page-item">'+i+"</li>"),i%40==0&&pages>i%40){pageHtml.append('<li class="gitment-comments-page-item">Next</li>');break}}$cpEl.html(pageHtml.toString())}}else error("initComments error.")}))},makeHtml:function(content){return(new showdown.Converter).makeHtml(content)},getUrlParam:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i"),r=decodeURI(window.location.search).substr(1).match(reg);return null!=r?unescape(r[2]):null},diffNowDateFormat:function(date){var diffMinute=((new Date).getTime()-new Date(date).getTime())/1e3/60;return 0<diffMinute&&diffMinute<1?"刚刚":1<diffMinute&&diffMinute<60?Math.floor(diffMinute)+"分前":60<diffMinute&&diffMinute<1440?Math.floor(diffMinute/60)+"小时前":1440<diffMinute&&diffMinute<10080?Math.floor(diffMinute/60/24)+"天前":10080<diffMinute&&diffMinute<40320?Math.floor(diffMinute/60/24/7)+"周前":40320<diffMinute&&diffMinute<483840?Math.floor(diffMinute/60/24/7/4)+"月前":Math.floor(diffMinute/60/24/7/4/12)+"年前"},replaceAll:function(str,preRepStr,afterRepStr){return str.replace(new RegExp(preRepStr,"gm"),afterRepStr)},saveAuthInfo:function(userInfo){localStorage.setItem("token",userInfo.token),userInfo.token=null,localStorage.setItem("userInfo",JSON.stringify(userInfo))},clearAuthInfo:function(){localStorage.removeItem("token"),localStorage.removeItem("userInfo"),ktConfig.userId=null},getUserInfo:function(){let userInfo=localStorage.getItem("userInfo");return userInfo?JSON.parse(userInfo):null},getOpenId:function(){let userInfo=this.getUserInfo();return userInfo&&userInfo.hasOwnProperty("openId")?userInfo.openId:null},getToken:function(){return localStorage.getItem("token")},setStorage:function(k,v){localStorage.setItem(k,v)},getStorage:function(k){return localStorage.getItem(k)},removeStorage:function(k){localStorage.removeItem(k)},getUserId:function(){let userInfo=this.getUserInfo();return userInfo&&userInfo.hasOwnProperty("id")?userInfo.id:null},getUsername:function(){let userInfo=this.getUserInfo();return userInfo&&userInfo.hasOwnProperty("username")?userInfo.username:null},getNickname:function(){let userInfo=this.getUserInfo();return userInfo&&userInfo.hasOwnProperty("nickname")?userInfo.nickname:null},isLogin:function(){let isLogin=null;return $.ajax({type:"POST",url:ktConfig.api.loginCheck,async:!1,success:function(r){ktUtils.isRequestSuccess(r)&&(isLogin=!0)}}),isLogin},signOut:function(){$.ajax({type:"GET",url:ktConfig.api.signOut+"?userId="+ktUtils.getUserId()})},getCurrentVipsEndDate:function(){let r=ktUtils.get(ktConfig.api.getVipInfo),result={};if(ktUtils.isRequestSuccess(r)){const data=r.data;console.log(data),result[ktConfig.vip.kt]=data.vip1EndDate,result[ktConfig.vip.seal]=data.vip2EndDate}return result},checkUserAllVip:function(){let r=ktUtils.get(ktConfig.api.getVipInfo);if(ktUtils.isRequestSuccess(r)){const data=r.data;console.log(data);let vip1EndDate=data.vip1EndDate,vip2EndDate=data.vip2EndDate,vip1=!1,vip2=!1;if(vip1EndDate){vip1=new Date(vip1EndDate+" 23:59:59")>=new Date}if(vip2EndDate){vip2=new Date(vip2EndDate+" 23:59:59")>=new Date}return data[ktConfig.vip.kt]=vip1,data[ktConfig.vip.seal]=vip2,data}return null},checkVipEndDate:function(vipEndDate){if(vipEndDate){return new Date(vipEndDate+" 23:59:59")>=new Date}return!1},isVip:function(){let vipsEndDate=ktUtils.getCurrentVipsEndDate();if(vipsEndDate[ktConfig.vip.kt]){let endDate=vipsEndDate[ktConfig.vip.kt]+" 23:59:59";return new Date(endDate)>=new Date}return!1},isSealVip:function(){let vipsEndDate=ktUtils.getCurrentVipsEndDate();if(vipsEndDate[ktConfig.vip.seal]){let endDate=vipsEndDate[ktConfig.vip.seal]+" 23:59:59";return new Date(endDate)>=new Date}return!1},showLoginPop:function(){pop({width:300,height:200,title:"网站登录",content:$("#loginPop")})},setCommodityToken:function(key,token){localStorage.setItem(key,token)},getCommodityToken:function(key){return localStorage.getItem(key)},debounce:function(func,wait,immediate){let timer;return function(){let context=this,args=arguments;if(timer&&clearTimeout(timer),immediate){let callNow=!timer;timer=setTimeout((()=>{timer=null}),wait),callNow&&func.apply(context,args)}else timer=setTimeout((()=>{func.apply()}),wait)}},removeModuleZz:function(){$("#zzRec").remove()},removeSelfZz:function(){},removeSelfZz2:function(){const pathname=window.location.pathname;let as=$("#zzRec").find("a"),arr=[];$.each(as,(function(i,item){let atx=$(item).attr("href");(pathname===atx||arr.includes(atx))&&$(item).parents(".kt-tl-recommend-box").remove(),arr.push(atx)}))},closePop:function(){$("[deletes=mry-opo]").click()},showLoading:function(){$(".my-mask").show()},hideLoading:function(){$(".my-mask").hide()},dataURLtoBlob:function(dataUrl){let arr=dataUrl.split(","),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);for(;n--;)u8arr[n]=bstr.charCodeAt(n);return new Blob([u8arr],{type:mime})},blobToDataURL:function(blob){let a=new FileReader;a.onload=function(e){callback(e.target.result)},a.readAsDataURL(blob)},htmlEscape:function(text){return text.replace(/[<>"&]/g,(function(match,pos,originalText){switch(match){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;"}}))},adCount:function(name){ktUtils.aPost(ktConfig.api.adCount.replace("{name}",name),{},(function(r){}))},setMockDataTableInfo:function(val){localStorage.setItem("tableInfos",JSON.stringify(val))},getMockDataTableInfo:function(){let val=localStorage.getItem("tableInfos");return val?JSON.parse(val):[]},delMockDataTableInfo:function(){localStorage.removeItem("tableInfos")},money2Chinese:function(money){let integerNum,decimalNum,parts,cnNums=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],cnIntRadice=["","拾","佰","仟"],cnIntUnits=["","万","亿","兆"],cnDecUnits=["角","分","毫","厘"],chineseStr="";if(!money)return"";if((money=parseFloat(money))>=1e15)return"";if(0===money)return chineseStr=cnNums[0]+"元整",chineseStr;if(-1===(money=money.toString()).indexOf(".")?(integerNum=money,decimalNum=""):(parts=money.split("."),integerNum=parts[0],decimalNum=parts[1].substr(0,4)),parseInt(integerNum,10)>0){let zeroCount=0,IntLen=integerNum.length;for(let i=0;i<IntLen;i++){let n=integerNum.substr(i,1),p=IntLen-i-1,q=p/4,m=p%4;"0"===n?zeroCount++:(zeroCount>0&&(chineseStr+=cnNums[0]),zeroCount=0,chineseStr+=cnNums[parseInt(n)]+cnIntRadice[m]),0===m&&zeroCount<4&&(chineseStr+=cnIntUnits[q])}chineseStr+="元"}if(""!==decimalNum){let decLen=decimalNum.length;for(let i=0;i<decLen;i++){let n=decimalNum.substr(i,1);"0"!==n&&(chineseStr+=cnNums[Number(n)]+cnDecUnits[i])}}return""===chineseStr?chineseStr+=cnNums[0]+"元整":""===decimalNum&&(chineseStr+="整"),chineseStr},chineseMoney2Number:function(str){const numChar={"零":0,"壹":1,"贰":2,"叁":3,"肆":4,"伍":5,"陆":6,"柒":7,"捌":8,"玖":9},levelChar={"整":0,"元":1,"拾":10,"佰":100,"仟":1e3,"万":1e4,"亿":1e8},decUnits={"角":.1,"分":.01,"毫":.001,"厘":1e-4};let arr=Array.from(str),sum=0,temp=0,ySum=0,wSum=0;for(let i=0;i<arr.length;i++){const char=arr[i];if(numChar.hasOwnProperty(char)){let num=numChar[char];if(0===num)continue;temp=num}else{let unit=levelChar[char];if(void 0!==unit)"亿"===char?(ySum=(sum+temp)*unit,sum=0):"万"===char?(wSum=(sum+temp)*unit,sum=0):sum+=temp*unit,temp=0;else{sum+=temp*decUnits[char]}}}return ySum+wSum+sum},downloadForATag:function(name,url){const a=document.createElement("a");a.href=url,a.download=name,a.click(),a.remove()},initDataTable:function(id,options){let defaultOpts={url:kfc+"/media/list?type=1",method:"get",dataType:"json",contentType:"application/json,charset=utf-8",toolbar:"#toolbar",uniqueId:"id",height:500,cache:!1,striped:!0,queryParamsType:"limit",queryParams:function(params){return{current:Math.ceil(params.offset/params.limit)+1,size:params.limit,order:params.order,orderName:params.sort,keyword:params.search}},sidePagination:"server",sortable:!0,sortName:"createTime",sortOrder:"desc",search:!0,strictSearch:!0,showColumns:!0,showRefresh:!0,showToggle:!0,clickToSelect:!0,minimumCountColumns:2,cardView:!1,pagination:!0,pageNumber:1,pageSize:10,pageList:[10,25,50,100],paginationPreText:"上一页",paginationNextText:"下一页",paginationFirstText:"首页",paginationLastText:"末页",responseHandler:function(e){let data=e.data;return data.records&&data.records.length>0?{rows:data.records,total:data.total}:{rows:[],total:0}},onLoadSuccess:function(data){},onLoadError:function(res){},formatShowingRows:function(pageFrom,pageTo,totalRows){return"第"+pageFrom+"-"+pageTo+"行，总共"+totalRows},formatRecordsPerPage:function(pageNumber){return pageNumber+"行每页"}};if(id){if(options){if(options){Object.keys(options).forEach((function(key){defaultOpts[key]=options[key]}))}return $("#"+id).bootstrapTable("destroy").bootstrapTable(defaultOpts)}error("url等参数允许为空")}else error("id不允许为空")},isRequestSuccess:function(r){return r.errorCode===ktConfig.request.okCode},getFileReaderPromise:async function(files){let keys=Object.keys(files);const list=[];for(let i=0;i<keys.length;i++){const file=files[keys[i]].file,reader=new FileReader;await new Promise((resolve=>{reader.onload=event=>{const base64=event.target.result;list.push(base64),resolve()},reader.readAsDataURL(file)}))}return list},getImgInfoPromise:async function(base64){let result={},img=new Image;return img.src=base64,await new Promise((resolve=>{img.onload=function(){const w=img.width,h=img.height;result={width:w,height:h,base64:base64,image:img},resolve()}})),result},setVipTagBtn:function(tag){const vipBtnElm=$(".kt-btn-vip0"),btnTxt=vipBtnElm.text();vipBtnElm.html(btnTxt+'<div class="kt-btn-vip-ribbon"><span>'+tag+"</span></div>")},setVipBtn:function(){const vipBtnElm=$(".kt-btn-vip"),btnTxt=vipBtnElm.text();vipBtnElm.html(btnTxt+'<div class="kt-btn-vip-ribbon"><span>免费</span></div>')},setVip2Btn:function(){const vipBtnElm=$(".kt-btn-vip2"),btnTxt=vipBtnElm.text();vipBtnElm.html(btnTxt+'<div class="kt-btn-vip-ribbon"><span>免费</span></div>')},convertImageToBase64:function(){return new Promise(((resolve,reject)=>{const reader=new FileReader;reader.readAsDataURL(file),reader.onload=()=>{resolve(reader.result)},reader.onerror=reject}))},getDomainByUrl:function(url,withHead){const match=url.match(/^((https?|ftp):\/\/)?([a-z0-9.-]+\.[a-z]{2,})(\/[^\s]*)?$/i);return match?(withHead?match[1]||"http://":"")+match[3]:(console.log("没有匹配到URL"),null)},isIpAddress:function(ip){return/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/.test(ip)},getCurrentScroll:function(selector){let containerEl=document.querySelector(selector);return{top:containerEl.scrollTop,left:containerEl.scrollLeft}},checkForm:function(selector){let form=document.querySelector(selector);return form.classList.add("was-validated"),form.checkValidity()},checkFormByElm:function(formElm){return formElm.classList.add("was-validated"),formElm.checkValidity()}};var log=function(){if(ktConfig.logEnable){var len=arguments.length;1===len&&console.log(arguments[0]),2===len&&console.log(arguments[0],arguments[1])}},error=function(){var len=arguments.length;1===len&&console.error(arguments[0]),2===len&&console.error(arguments[0],arguments[1])},StringBuilder=function(){this._stringArray=[]},itl;function interval(){var pro=0,step=.5;itl=setInterval((function(){pro+=step;var pbaEle=$("#pba");pbaEle.attr("style","width:"+pro+"%"),pbaEle.text(pro.toFixed(1)+"%"),pro>=80&&(step=.1),pro>=99.8&&clearInterval(itl)}),50)}function showLoading(){$("#pbg").html('<div class="progress">\n                                    <div id="pba" class="progress-bar progress-bar-striped progress-bar-animated" style="width:0">0%</div>\n                                </div>'),interval()}function finishLoading(status){var pbaEle=$("#pba");clearInterval(itl),200===status?(pbaEle.attr("style","width:100%"),pbaEle.text("完成"),pbaEle.addClass("bg-success")):(pbaEle.addClass("bg-danger"),pbaEle.text("失败，请重试")),pbaEle.removeClass("progress-bar-striped"),pbaEle.removeClass("progress-bar-animated")}StringBuilder.prototype.append=function(str){this._stringArray.push(str)},StringBuilder.prototype.toString=function(){return this._stringArray.join("")},StringBuilder.prototype.size=function(){return this._stringArray.length},String.prototype.startWith=function(str){return new RegExp("^"+str).test(this)},String.prototype.endWith=function(str){return new RegExp(str+"$").test(this)},Date.prototype.format=function(format){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var k in/(y+)/.test(format)&&(format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return format},$.fn.extend({insertContent:function(myValue,t){var $t=$(this)[0];if(document.selection){this.focus();var sel=document.selection.createRange();sel.text=myValue,this.focus(),sel.moveStart("character",-l);var wee=sel.text.length;if(2==arguments.length){var l=$t.value.length;sel.moveEnd("character",wee+t),t<=0?sel.moveStart("character",wee-2*t-myValue.length):sel.moveStart("character",wee-t-myValue.length),sel.select()}}else if($t.selectionStart||"0"==$t.selectionStart){var startPos=$t.selectionStart,endPos=$t.selectionEnd,scrollTop=$t.scrollTop;$t.value=$t.value.substring(0,startPos)+myValue+$t.value.substring(endPos,$t.value.length),this.focus(),$t.selectionStart=startPos+myValue.length,$t.selectionEnd=startPos+myValue.length,$t.scrollTop=scrollTop,2==arguments.length&&($t.setSelectionRange(startPos-t,$t.selectionEnd+t),this.focus())}else this.value+=myValue,this.focus()}});