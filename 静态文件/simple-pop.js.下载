/*
*时间：
*2016年9月24日 17:42:54
*作者：无言
* pop弹窗插件 v1.0.0
*
*/


function pop(obj, closeCallback) {
    function open(obj) {
        $('body').append('<div id="mry-opo"><div id="mry-opo-title"></div><div  id="mry-opo-content" style="overflow-x: hidden"></div></div>');
        const div = $('#mry-opo');
        const contentElm = $('#mry-opo-content');
        $('#mry-opo-title').text(obj.title);
        if (typeof (obj.content) === 'object') {
            var outerHtml = $(obj.content).prop('outerHTML');
            var $oh = $(outerHtml);
            $oh.css('display', 'block');
            contentElm.html($oh.prop('outerHTML'));
        } else {
            contentElm.text(obj.content);
        }

        div.css('width', obj.width + 'px');
        div.css('height', obj.height + 'px');
        div.css('margin-left', -(parseInt(obj.width) / 2) + 'px');
        div.css('margin-top', -(parseInt(obj.height) / 2) + 'px');
        div.css('background', obj.backgorund);
        $('#mry-mask').css('display', 'block');
        contentElm.css('height', obj.height - 30 + 'px');


        // 监听浏览器窗口宽度变化，当窗口小于等于width时，动态将width设置为100%
        resizeWidth(div, obj);
        $(window).resize(function () {
            resizeWidth(div, obj);
        });
    }

    function resizeWidth(div, obj) {
        const windowWidth = $(window).width();
        if (windowWidth <= obj.width && windowWidth > 574) {
            div.css('margin-left', -((windowWidth - 10) / 2) + 'px');
            div.css('width', windowWidth - 10 + 'px');
            div.css('background', 'red!important');
        } else if (windowWidth > obj.width && div.width() !== obj.width) {
            div.css('width', obj.width + 'px');
            div.css('margin-left', -(parseInt(obj.width) / 2) + 'px');
        }
    }

    function del() {
        // $('#mry-opo').append('<a href="javascript:void(0)" deletes="mry-opo" style="position:absolute;right:10px;top:6px;color:#333;font-size:12px;width: 18px;background-color: #dee2e6;text-align: center;">X</a>');
        $('#mry-opo').append('<div id="popClose" style="position:absolute;right:10px;top:6px;color:#333;font-size:12px;width: 18px;background-color: #dee2e6;text-align: center;"><a id="popCloseA" href="javascript:void(0)" style="display: block" deletes="mry-opo" >X</a></div>');
        $('#popClose').on('click', function () {
            $('#mry-opo,#mry-mask').remove();
            if (closeCallback) closeCallback();
        });
    }

    $('body').append('<div id="mry-mask" deletes="mry-opo"></div>');
    var ject = obj;
    ject.width = parseInt(obj.width) || 300;
    ject.height = parseInt(obj.height) || 300;
    ject.title = obj.title || '来自提示信息';
    ject.content = obj.content || '这是一个提示信息';
    ject.backgorund = obj.backgorund || '#fff';
    open(ject);
    del();
}